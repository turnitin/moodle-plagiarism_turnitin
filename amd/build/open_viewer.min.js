define ("plagiarism_turnitin/open_viewer",["jquery"],function(a){return{origreport_open:function origreport_open(){var b=this;a(document).on("click",".pp_origreport_open",function(){for(var c=a(this).attr("class").replace(/\s+/," ").split(" "),d=0;d<c.length;d++){if(-1!==c[d].indexOf("origreport_")&&"pp_origreport_open"!=c[d]){var e=c[d].split("_");b.openDV("origreport",e[1],e[2])}}})},grademark_open:function grademark_open(){var b=this;a(document).on("click",".pp_grademark_open",function(){for(var c=a(this).attr("class").replace(/\s+/," ").split(" "),d=0;d<c.length;d++){if(-1!==c[d].indexOf("grademark_")&&"pp_grademark_open"!=c[d]){var e=c[d].split("_");b.openDV("grademark",e[1],e[2])}}})},openDV:function openDV(b,c,d){var e=this,f=window.open("","turnitin_viewer"),g="<div class=\"tii_dv_loading\" style=\"text-align:center;\">";g+="<img src=\""+M.cfg.wwwroot+"/plagiarism/turnitin/pix/tiiIcon.svg\" style=\"width:100px; height: 100px\">";g+="<p style=\"font-family: Arial, Helvetica, sans-serif;\">"+M.str.plagiarism_turnitin.loadingdv+"</p>";g+="</div>";a(f.document.body).html(g);a.ajax({type:"POST",url:M.cfg.wwwroot+"/plagiarism/turnitin/ajax.php",dataType:"json",data:{action:"get_dv_html",submissionid:c,dvtype:b,cmid:d,sesskey:M.cfg.sesskey},success:function success(b){a(f.document.body).html(g+b);f.document.forms[0].submit();f.document.close();e.checkDVClosed(c,d,f)}})},checkDVClosed:function checkDVClosed(a,b,c){var d=this;if(c.closed){d.refreshScores(a,b)}else{setTimeout(function(){d.checkDVClosed(a,b,c)},500)}},refreshScores:function refreshScores(b,c){var d=new Date().getTime();a.ajax({type:"POST",url:M.cfg.wwwroot+"/plagiarism/turnitin/ajax.php",dataType:"json",data:{action:"update_grade",submission:b,cmid:c,sesskey:M.cfg.sesskey},success:function success(){var b=new Date().getTime()-d;if(3e3>b){window.location=window.location}else{a(".turnitin_score_refresh_alert").show()}}})}}});
//# sourceMappingURL=open_viewer.min.js.map
