{"version":3,"file":"modal_rubric_manager_launch.min.js","sources":["../src/modal_rubric_manager_launch.js"],"sourcesContent":["/**\n * Javascript controller for the Rubric Manager launcher\n *\n * @copyright Turnitin\n * @author 2019 David Winn <dwinn@turnitin.com>\n * @module plagiarism_turnitin/modal_rubric_manager_launch\n */\n\ndefine(\n    [\n        'jquery',\n        'core/ajax',\n        'core/notification',\n        'core/custom_interaction_events',\n        'core/modal',\n        'core/modal_registry',\n        'core/modal_events'\n    ],\n    function($, Ajax, Notification, CustomEvents, Modal, ModalRegistry, ModalEvents) {\n\n        var registered = false;\n        var SELECTORS = {\n            HIDE_BUTTON: '[data-action=\"hide\"]',\n            MODAL: '[data-region=\"modal\"]'\n        };\n\n        /**\n         * Constructor for the Modal.\n         *\n         * @param {object} root The root jQuery element for the modal\n         */\n        var ModalRubricManagerLaunch = function(root) {\n            Modal.call(this, root);\n        };\n\n        ModalRubricManagerLaunch.TYPE = 'plagiarism_turnitin-modal_rubric_manager_launch';\n        ModalRubricManagerLaunch.TEMPLATE = 'plagiarism_turnitin/modal_rubric_manager_launch';\n        ModalRubricManagerLaunch.prototype = Object.create(Modal.prototype);\n        ModalRubricManagerLaunch.prototype.constructor = ModalRubricManagerLaunch;\n\n        /**\n         * Set up all of the event handling for the modal.\n         *\n         * @method registerEventListeners\n         */\n        ModalRubricManagerLaunch.prototype.registerEventListeners = function() {\n            // Apply parent event listeners.\n            Modal.prototype.registerEventListeners.call(this);\n\n            // On cancel, then hide the modal.\n            this.getModal().on(CustomEvents.events.activate, SELECTORS.HIDE_BUTTON, function(e, data) {\n                var cancelEvent = $.Event(ModalEvents.cancel);\n                this.getRoot().trigger(cancelEvent, this);\n\n                if (!cancelEvent.isDefaultPrevented()) {\n                    this.hide();\n                    data.originalEvent.preventDefault();\n\n                    refreshRubricSelect();\n                }\n            }.bind(this));\n\n            // On clicking outside the modal, refresh the Rubrics.\n            this.getRoot().click(function(e) {\n                if (!$(e.target).closest(SELECTORS.MODAL).length) {\n                    refreshRubricSelect();\n                }\n            }.bind(this));\n        };\n\n        /**\n         * Get the rubrics belonging to a user from Turnitin and refresh menu accordingly.\n         */\n        function refreshRubricSelect() {\n            var currentRubric = $('#id_plagiarism_rubric').val();\n            $.ajax({\n                type: \"POST\",\n                url: M.cfg.wwwroot + \"/plagiarism/turnitin/ajax.php\",\n                dataType: 'json',\n                data: {\n                    action: \"refresh_rubric_select\", assignment: $('input[name=\"instance\"]').val(),\n                    modulename: $('input[name=\"modulename\"]').val(), course: $('input[name=\"course\"]').val()\n                },\n                success: function (data) {\n                    $($('#id_plagiarism_rubric')).empty();\n                    var options = data;\n                    $.each(options, function (i, val) {\n                        if (!$.isNumeric(i) && i !== \"\") {\n\n                            var optgroup = $('<optgroup>');\n                            optgroup.attr('label', i);\n\n                            $.each(val, function (j, rubric) {\n                                var option = $(\"<option></option>\");\n                                option.val(j);\n                                option.text(rubric);\n\n                                optgroup.append(option);\n                            });\n\n                            $('#id_plagiarism_rubric').append(optgroup);\n\n                        } else {\n                            $('#id_plagiarism_rubric').append(new Option(val, i, false, false)).trigger('change');\n                        }\n                    });\n\n                    $('#id_plagiarism_rubric' + ' option[value=\"' + currentRubric + '\"]').attr(\"selected\", \"selected\");\n                }\n            });\n        }\n\n        ModalRubricManagerLaunch.refreshRubricSelect = refreshRubricSelect;\n\n        // Automatically register with the modal registry the first time this module is imported so that\n        // you can create modals of this type using the modal factory.\n        if (!registered) {\n            ModalRegistry.register(ModalRubricManagerLaunch.TYPE,\n                ModalRubricManagerLaunch,\n                'plagiarism_turnitin/modal_rubric_manager_launch');\n            registered = true;\n        }\n\n        return ModalRubricManagerLaunch;\n    }\n);"],"names":["define","$","Ajax","Notification","CustomEvents","Modal","ModalRegistry","ModalEvents","registered","SELECTORS","ModalRubricManagerLaunch","root","call","this","refreshRubricSelect","currentRubric","val","ajax","type","url","M","cfg","wwwroot","dataType","data","action","assignment","modulename","course","success","empty","options","each","i","isNumeric","append","Option","trigger","optgroup","attr","j","rubric","option","text","TYPE","TEMPLATE","prototype","Object","create","constructor","registerEventListeners","getModal","on","events","activate","e","cancelEvent","Event","cancel","getRoot","isDefaultPrevented","hide","originalEvent","preventDefault","bind","click","target","closest","length","register"],"mappings":"AAQAA,yDACI,CACI,SACA,YACA,oBACA,iCACA,aACA,sBACA,sBAEJ,SAASC,EAAGC,KAAMC,aAAcC,aAAcC,MAAOC,cAAeC,iBAE5DC,YAAa,EACbC,sBACa,uBADbA,gBAEO,wBAQPC,yBAA2B,SAASC,MACpCN,MAAMO,KAAKC,KAAMF,gBAyCZG,0BACDC,cAAgBd,EAAE,yBAAyBe,MAC/Cf,EAAEgB,KAAK,CACHC,KAAM,OACNC,IAAKC,EAAEC,IAAIC,QAAU,gCACrBC,SAAU,OACVC,KAAM,CACFC,OAAQ,wBAAyBC,WAAYzB,EAAE,0BAA0Be,MACzEW,WAAY1B,EAAE,4BAA4Be,MAAOY,OAAQ3B,EAAE,wBAAwBe,OAEvFa,QAAS,SAAUL,MACfvB,EAAEA,EAAE,0BAA0B6B,YAC1BC,QAAUP,KACdvB,EAAE+B,KAAKD,SAAS,SAAUE,EAAGjB,QACpBf,EAAEiC,UAAUD,IAAY,KAANA,EAgBnBhC,EAAE,yBAAyBkC,OAAO,IAAIC,OAAOpB,IAAKiB,GAAG,GAAO,IAAQI,QAAQ,cAhB/C,KAEzBC,SAAWrC,EAAE,cACjBqC,SAASC,KAAK,QAASN,GAEvBhC,EAAE+B,KAAKhB,KAAK,SAAUwB,EAAGC,YACjBC,OAASzC,EAAE,qBACfyC,OAAO1B,IAAIwB,GACXE,OAAOC,KAAKF,QAEZH,SAASH,OAAOO,WAGpBzC,EAAE,yBAAyBkC,OAAOG,cAO1CrC,EAAE,uCAA8Cc,cAAgB,MAAMwB,KAAK,WAAY,sBAxEnG7B,yBAAyBkC,KAAO,kDAChClC,yBAAyBmC,SAAW,mDACpCnC,yBAAyBoC,UAAYC,OAAOC,OAAO3C,MAAMyC,YACtBG,YAAcvC,yBAOjDA,yBAAyBoC,UAAUI,uBAAyB,WAExD7C,MAAMyC,UAAUI,uBAAuBtC,KAAKC,WAGvCsC,WAAWC,GAAGhD,aAAaiD,OAAOC,SAAU7C,sBAAuB,SAAS8C,EAAG/B,UAC5EgC,YAAcvD,EAAEwD,MAAMlD,YAAYmD,aACjCC,UAAUtB,QAAQmB,YAAa3C,MAE/B2C,YAAYI,4BACRC,OACLrC,KAAKsC,cAAcC,iBAEnBjD,wBAENkD,KAAKnD,YAGF8C,UAAUM,MAAM,SAASV,GACrBtD,EAAEsD,EAAEW,QAAQC,QAAQ1D,iBAAiB2D,QACtCtD,uBAENkD,KAAKnD,QA6CXH,yBAAyBI,oBAAsBA,oBAI1CN,aACDF,cAAc+D,SAAS3D,yBAAyBkC,KAC5ClC,yBACA,mDACJF,YAAa,GAGVE"}